---
title: Build a Weaivate Transformation Agent
sidebar_label: 'Tutorial: Enrich your dataset'
description: Learn how to create additional properties in your dataset with the Weaviate Transformation Agent.
sidebar_position: 40
image: og/docs/tutorials.jpg
# tags: ['basics']
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import FilteredTextBlock from '@site/src/components/Documentation/FilteredTextBlock';
import PyCode from '!!raw-loader!/developers/agents/_includes/transformation_agent_tutorial_enrich_dataset.py';

In this tutorials, we will build a simple Weaviate [`TransformationAgent`](https://weaviate.io/developers/agents/transformation). We will build an agent that has access to a collection containing a bunch or research papers, their abstracts and titles. We will then use the agent to create additional properties for eaach of our objects in the collection.

We've prepared a public dataset that you can use to explore the Transformation Agent and it's available on Hugging Face:

- [**ArxivPapers:**](https://huggingface.co/datasets/weaviate/agents/viewer/transformation-agent-papers) A dataset that lists titles and abstracts of research papers.

## Introduction: What are Transformation Agents?

The `TransformationAgent` is able to access a Weaviate collection of your chosing, and perform operations on the objects within it. However, each operation for the agent can be defined in natural language. The agent will then use an LLM to complete the instructions in the operation.

import WeaviateAgentsArxivFlowchart from '/developers/agents/_includes/transformation_agent_tutorial_arxiv_flowchart.png';

<div class="row">
  <div class="card">
    <div class="card__image">
      <img
        src={WeaviateAgentsArxivFlowchart}
        alt="Weaviate Query Agent flowchart"
      />
    </div>
  </div>
</div>
<br />

The Transformation Agent:

1. **Receives a task** to create new properties or update existing ones.
2. **Retrieves the needed data from Weaviate**, which will be updated or used to create the new properties.
3. **Uses an appropriate foundation model** (e.g. large language model) to perform the transformation of the data.
4. **Stores the transformed data in Weaviate** by creating new propoerties or updating existing ones.

<hr />

## Prerequisites

To use the Weaviate Agents and Weaviate Embedding service, you need to have a **[Weaviate Cloud](https://console.weaviate.cloud)** account.

## Step 1: Set up Weaviate

Now, let's get started by setting up a Weaviate Cloud instance that we will use for this tutorial and connecting it to the Python client.

### 1.1 Create a Weaviate Cloud cluster

1. Create a [free Sandbox cluster](/developers/wcs/manage-clusters/create#sandbox-clusters) in Weaviate Cloud.
1. Take note of the `REST Endpoint` and `Admin` API key to connect to your cluster. (for more info, check out the [quickstart](/developers/wcs/quickstart#22-connect-to-your-weaviate-cloud-instance))

:::tip
In this tutorial, we are using the [Weaviate Embeddings](https://weaviate.io/developers/weaviate/model-providers/weaviate) service as the vectorizer, so you do not have to provide any extra keys for external embedding providers. Weaviate Embeddings uses the `Snowflake/snowflake-arctic-embed-l-v2.0` as the default embedding model.<br/><br/>
If you want to use another vectorizer, check out the list of supported [model providers](../../weaviate/model-providers/index.md).
:::

### 1.2 Install the Python libraries

In order to install the Weaviate Python client together with the `agents` component, run:

```
pip install "weaviate-client[agents]"
```

You will also need `datasets`, a lightweight library providing access to the publicly hosted datasets on HuggingFace.

```
pip install datasets
```

### 1.3 Connect to your instance

Now, you can finally connect to your Weaviate Cloud instance with the parameters from the first step:

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START ConnectToWeaviate"
      endMarker="# END ConnectToWeaviate"
      language="py"
    />
  </TabItem>
</Tabs>

After running this snippet, you should see the message `True` printed out, which means that you have successfully connected to your instance.

## Step 2: Prepare the Collections

In the following code blocks, we are pulling our demo datasets from Hugging Face and writing them to new collections in our Weaviate Sandbox cluster. Before we can start importing the data into Weaviate, we need to **define the collections**, which means setting up the data schema and choosing the vectorizer/embedding service.

### 2.1 Define the Collections

import WeaviateAgentsArxivDataset from '/developers/agents/_includes/weaviate-agents-arxiv-dataset.png';

<div class="row">
  <div class="col col--3">
    <br />
    <p>
      On this image, you can see what the objects in the dataset{' '}
      <code>ArxivPapers</code> look like.
    </p>
  </div>
  <div class="col col--9">
    <div class="card">
      <div class="card__image">
        <img
          src={WeaviateAgentsArxivDataset}
          alt="The arXiv.org paper dataset"
        />
      </div>
      <div class="card__body">The arXiv.org paper dataset</div>
    </div>
  </div>
</div>
<br />

For the collection `ArxivPapers`, we are going to use the [`auto-schema`](../../weaviate/config-refs/schema/index.md#auto-schema) option which creates properties automatically based on the imported data.

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START DefineCollections"
      endMarker="# END DefineCollections"
      language="py"
    />
  </TabItem>
</Tabs>

### 2.2 Populate the database

Now, we can import the pre-vectorized data ([E-Commerce](https://huggingface.co/datasets/weaviate/agents/viewer/query-agent-ecommerce) and [Brands](https://huggingface.co/datasets/weaviate/agents/viewer/query-agent-brands)) into our Weaviate Cloud instance:

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START PopulateDatabase"
      endMarker="# END PopulateDatabase"
      language="py"
    />
  </TabItem>
</Tabs>

By calling `len()` on our collections, we can check that the import has successfully concluded and see what the size of our collections is.

```
Size of the E-Commerce dataset: 448
```

### 2.3 Inspect the collection in the Explorer tool

The `TransformationAgent` will modify the collection as we go along. This is a good time to take a look at the contents of your "ArxivPapers" collection. If all goes well, you should be seeing 2 properties listed for each object:

- `title`: the title of the paper.
- `abstract`: the abstract of the paper.

As well as the `vectors` for each object.

## Step 3: Set up the Transformation Agent

The star of the show for the `TransformationAgent` are the operations.

We can now define transformation operations which we want to perform on our collection. An operation can be:

- Appending a new property
- Updating an existing property

### 3.1 Append new properties

To append a new property, we define an operation with:

- **`instrcution`**: This is where you can describe, in natural language, what you want this new property to be.
- **`property_name`**: The name you want the property to have
- **`data_type`**: The specific datatype the property should be. E.g.: `DataType.TEXT`, `DataType.TEXT_ARRAY`, `DataType.BOOL`, `DataType.INT` etc.
- **`view_properties`**: Sometimes, you may want to create properties that are based on information provided in other properties, this is where you can list out which properties the instruction should view.

#### 3.1.1 Create a list of topics

First, let's append a new property called "topics", which should be a `TEXT_ARRAY`. Based on the "abstract" and "title", let's ask for the LLM to extract a list of topic tags. We can be specific here. Let's ask for no more than 5.

```
from weaviate.agents.classes import Operations
from weaviate.collections.classes.config import DataType

add_topics = Operations.append_property(
    property_name="topics",
    data_type=DataType.TEXT_ARRAY,
    view_properties=["abstract", "title"],
    instruction="""Create a list of topic tags based on the title and abstract.
    Topics should be distinct from eachother. Provide a maximum of 5 topics.
    Group similar topics under one topic tag.""",
)
```

#### 3.1.2 Add a French translation

Next, let's add a new "french_abstract" property which is simply a translation of the "abstract"

```
add_french_abstract = Operations.append_property(
      property_name="french_abstract",
      data_type=DataType.TEXT,
      view_properties=["abstract"],
      instruction="Translate the abstract to French",
)
```

#### 3.1.3 Add NLP Relevance Score

This time, we can add a property which is an `INT`. Here, we ask the LLM to give a score from 0 to 10, based on how relevant tha paper is to Natural Language Processing.

```
add_nlp_relevance = Operations.append_property(
    property_name="nlp_relevance",
    data_type=DataType.INT,
    view_properties=["abstract"],
    instruction="""Give a score from 0-10 based on how relevant the abstract is to Natural Language Processing.
    The scale is from 0 (not relevant at all) to 10 (very relevant)""",
)
```

#### 3.1.4 Determine if it's a survey paper

Finally, let's ask for a `BOOL` property which indicates whether the paper is a survey or not. I.e., we'll ask the LLM to determine if the paper presents novel techniques, or whether it's a survey of existing ones.

```
is_survey_paper = Operations.append_property(
    property_name="is_survey_paper",
    data_type=DataType.BOOL,
    view_properties=["abstract"],
    instruction="""Determine if the paper is a "survey".
    A paper is considered survey it's a surveys existing techniques, and not if it presents novel techniques""",
)
```

## Step 4: Create & run the Transformation Agent

Once we have all of our operations defined, we can initialize a `TransformationAgent`.

When initializing the agent, we have to decide which `collection` it may have accesss to. In this case, we want it to have access to the "ArxivPapers" collection we previously created.

Next, we need to provide a list of `operations` which the agent should run. Here, we provide all the operations we defined above.

```
from weaviate.agents.transformation import TransformationAgent

agent = TransformationAgent(
    client=client,
    collection="ArxivPapers",
    operations=[
        add_topics,
        add_french_abstract,
        add_nlp_relevance,
        is_survey_paper,
    ],
)
```

### 3.2 Update an existing property

TODO

### 4.1 Running the transformations

By calling `update_all()`, we get the agent to spin up individual workflows for each operation. Each operation will then run on each object in our collectoion.

```
workflow_ids = agent.update_all()
```

### 4.2 Inspect the Operation Workflows

To inspect the status of our operations, we can take a look at the `workflow_ids` and get their status with `agent.get_status(workflow_id)`

```python
agent.get_status(workflow_id=workflow_ids[0].workflow_id)
```

## Summary

## Further resources

- [Weaviate Agents - Query Agent](./index.md)

## Questions and feedback

import DocsFeedback from '/_includes/docs-feedback.mdx';

<DocsFeedback />
