---
title: Build an E-Commerce assistant with Query Agents
sidebar_label: E-Commerce assistant with Query Agents
description: Learn how to build a simple e-commerce assistant agent with the Weaviate Query Agent.
sidebar_position: 1
image: og/docs/tutorials.jpg
# tags: ['basics']
---

In this tutorial, we will be building a simple e-commerce assistant agent with the [Weaviate Query Agent](https://weaviate.io/developers/agents). This agent will have access to a number of Weaviate collection, and will be capable of answering complex queries about brands and clothing items, accessing information from each collection.

To get started, we've prepared a few open datasets, available on Hugging Face. The first step will be walking through how to populate your Weaviate Cloud collections.

- [**E-commerce:**](https://huggingface.co/datasets/weaviate/agents/viewer/query-agent-ecommerce) A dataset that lists clothing items, prices, brands, reviews etc.
- [**Brands:**](https://huggingface.co/datasets/weaviate/agents/viewer/query-agent-brands) A dataset that lists clothing brands and information about them such as their parent brand, child brands, average customer rating etc.

## Step 1: Set up

### 1.1 Create a Weaviate Cloud cluster

To use the Weaviate Query Agent, first, create a [Weaviate Cloud](https://weaviate.io/deployment/serverless) accountüëá

1. Create a [free Sandbox cluster](/developers/wcs/manage-clusters/create#sandbox-clusters) in Weaviate Cloud.
2. Go to 'Embedding' and enable it, by default, this will make it so that we use `Snowflake/snowflake-arctic-embed-l-v2.0` as the embedding model
3. Take note of the `WEAVIATE_URL` and `WEAVIATE_API_KEY` to connect to your cluster below

:::tip
In this tutorial we are using the [Weaviate Embeddings](https://weaviate.io/developers/weaviate/model-providers/weaviate) service as the vectorizer so you do not have to provide any extra keys for external embedding providers.
:::

### 1.2 Install the Python client

In order to install the Weaviate Python client together with the `agents` component:

```
!pip install git+https://github.com/weaviate/weaviate-python-client.git@weaviate-agents-integration#egg=weaviate-client[agents]
!pip install datasets
```

### 1.3 Connect to your instance

```python
import os
from getpass import getpass

if "WEAVIATE_API_KEY" not in os.environ:
  os.environ["WEAVIATE_API_KEY"] = getpass("Weaviate API Key")
if "WEAVIATE_URL" not in os.environ:
  os.environ["WEAVIATE_URL"] = getpass("Weaviate URL")

import weaviate
from weaviate.auth import Auth

client = weaviate.connect_to_weaviate_cloud(
        cluster_url=os.environ.get("WEAVIATE_URL"),
        auth_credentials=Auth.api_key(os.environ.get("WEAVIATE_API_KEY")),
)
```

## Step 2: Prepare the Collections

import WeaviateAgentsEcommerceDataset from '/developers/weaviate/tutorials/img/weaviate-agents-ecommerce-dataset.png';

<div class="row">
  <div class="card">
    <div class="card__image">
      <img src={WeaviateAgentsEcommerceDataset} alt="Open a collection in Weaviate Cloud" />
    </div>
  </div>
</div>
<br />

### 2.1 Define the Collections

In the following code blocks, we are pulling our demo datasets from Hugging Face and writing them to new collections in our Weaviate Serverless cluster.

> ‚ùóÔ∏è The `QueryAgent` uses the descriptions of collections and properties to decide which ones to use when solving queries, and to access more information about properties. You can experiment with changing these descriptions, providing more detail, and more. It's good practice to provide property descriptions too. For example, below we make sure that the `QueryAgent` knows that prices are all in USD, which is information that would otherwise be unavailable.

```python
from weaviate.classes.config import Configure, Property, DataType

client.collections.delete_all()
client.collections.create(
    "Brands",
    description="A dataset that lists information about clothing brands, their parent companies, average rating and more.",
    vectorizer_config=Configure.Vectorizer.text2vec_weaviate()
    )

client.collections.create(
    "ecommerce",
    description="A dataset that lists clothing items, their brands, prices, and more.",
    vectorizer_config=Configure.Vectorizer.text2vec_weaviate(),
    properties=[
        Property(name="collection", data_type=DataType.TEXT),
        Property(name="category", data_type=DataType.TEXT),
        Property(name="tags", data_type=DataType.TEXT_ARRAY),
        Property(name="subcategory", data_type=DataType.TEXT),
        Property(name="name", data_type=DataType.TEXT),
        Property(name="description", data_type=DataType.TEXT),
        Property(name="brand", data_type=DataType.TEXT),
        Property(name="product_id", data_type=DataType.UUID),
        Property(name="colors", data_type=DataType.TEXT_ARRAY),
        Property(name="reviews", data_type=DataType.TEXT_ARRAY),
        Property(name="image_url", data_type=DataType.TEXT),
        Property(name="price", data_type=DataType.NUMBER, description="price of item in USD"),
    ]
    )
```

### 2.2 Populate the database

Now we can import the data into our Weaviate Cloud instance:

```python
from datasets import load_dataset
from datetime import datetime, timezone

brands_dataset = load_dataset("weaviate/agents", "query-agent-brands", split="train", streaming=True)
ecommerce_dataset = load_dataset("weaviate/agents", "query-agent-ecommerce", split="train", streaming=True)

brands_collection = client.collections.get("Brands")
ecommerce_collection = client.collections.get("ecommerce")

with brands_collection.batch.dynamic() as batch:
  for item in brands_dataset:
      batch.add_object(properties=item["properties"])

with ecommerce_collection.batch.dynamic() as batch:
  for item in ecommerce_dataset:
      batch.add_object(properties=item["properties"])
```

## Step 3: Set Up the Query Agent

When setting up the query agent, we have to provide it a few things:

- The `client`
- The `collection` which we want the agent to have access to.
- (Optionally) A `system_prompt` that describes how our agent should behave
- (Optionally) Timeout - which for now defaults to 60s.

Let's start with a simple agent. Here, we're creating an `agent` that has access to our `brands`, `ecommerce` & `financial_contracts` datasets.

```python
from weaviate.agents.query import QueryAgent

agent = QueryAgent(
    client=client, collections=["ecommerce", "Brands"],
)
```

## Step 4: Run the Query Agent

When we run the agent, it will first make a few decisions, depending on the query:

1. The agent will decide which collection or collections to look up an answer in.
2. The agent will also decide whether to perform a regular **_search query_**, what **_filters_** to use, whether to do an **_aggregation query_**, or all of them together!
3. It will then provide a reponse within **`QueryAgentResponse`**.

### 4.1 Ask a Question

**Let's start with a simple question: "I like the vintage clothes, can you list me some options that are less than $200?"**

We can then also inspect how the agent responded, what kind of searches it performed on which collections, whether it has identified if the final answer is missing information or not, as well as the final answer üëá

```python
from weaviate.agents.utils import print_query_agent_response

response = agent.run("I like the vintage clothes, can you list me some options that are less than $200?")
print_query_agent_response(response)
```

### 4.2 Ask a follow up question

The agent can also be provided with additional context. For example, we can provide the previous response as context and get a `new_response`

new_response = agent.run("What about some nice shoes, same budget as before?", context=response)
print_query_agent_response(new_response)

Now let's try a question that sholud require an aggregation. Let's see which brand lists the most shoes.

```python
response = agent.run("What is the the name of the brand that lists the most shoes?")
print_query_agent_response(response)
```

### 4.3 Search over multiple collections

In some cases, we need to combine the results of searches across multiple collections. From the result above, we can see that "Loom & Aura" lists the most shoes.

Let's imagine a scenario where the user would now want to find out more about this company, _as well_ as the items that they sell.

```python
response = agent.run("Does the brand 'Loom & Aura' have a parent brand or child brands and what countries do they operate from? "
                     "Also, what's the average price of a shoe from 'Loom & Aura'?")

print_query_agent_response(response)
```

### 4.4 Changing the System Prompt

In some cases, you may want to define a custom `system_prompt` for your agent. This can help you provide the agent with some default instructions as to how to behave. For example, let's create an agent that will always answer the query in the users language.

```python
multi_lingual_agent = QueryAgent(
    client=client, collections=["ecommerce", "Brands"],
    system_prompt="You are a helpful assistant that always generated the final response in the users language."
    " You may have to translate the user query to perform searches. But you must always respond to the user in their own language."
)
```

For example, this time lets ask something that is about weather!
TODO

### 4.5 Try More Questions

- For example Let's try to find out more about the brans "Eko & Stitch"

```python
response = agent.run("Does Eko & Stitch have a branch in the UK? Or if not, does it have parent or child company in the UK?")

print(response.final_answer)
```

## Summary

## Further resources
